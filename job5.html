<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>åœ¨çº¿è´­ç‰©æŠ˜æ‰£ç³»ç»Ÿ</title>
  <style>
    body { font-family: "Microsoft YaHei", sans-serif; margin: 20px; }
    .tip { background: #f0f8ff; padding: 10px; border-left: 4px solid #4682b4; margin: 10px 0; }
    .form-group { margin: 8px 0; }
    label { display: inline-block; width: 100px; }
    table { border-collapse: collapse; margin-top: 15px; width: 100%; }
    th, td { border: 1px solid #999; padding: 6px; text-align: center; }
  </style>
</head>
<body>

<!-- ç¬¬ä¸€æ–¹é¢ï¼šä½¿ç”¨ document.write() æç¤ºæŠ˜æ‰£æ”¿ç­–ï¼ˆå‚è€ƒ P221ï¼‰ -->
<script>
  document.write("<h2>æ¬¢è¿å…‰ä¸´åœ¨çº¿æŠ˜æ‰£å•†åŸ</h2>");
  document.write("<div class='tip'>");
  document.write("æœ¬åº—ä¼˜æƒ è§„åˆ™ï¼š<br>");
  document.write("â€¢ VIPå®¢æˆ·äº«9æŠ˜<br>");
  document.write("â€¢ åŠ æ€¥è®¢å•åŠ æ”¶10%<br>");
  document.write("â€¢ æ¯å°æ—¶å‰10åˆ†é’Ÿï¼ˆ00~09åˆ†ï¼‰é¢å¤–äº«85æŠ˜<br>");
  document.write("â€¢ æ™®é€šå®¢æˆ·è´­ä¹°è¶…è¿‡3ä»¶ï¼Œæ€»é‡‘é¢å†æ‰“9æŠ˜");
  document.write("</div>");
</script>

<!-- æ˜¾ç¤ºå½“å‰æ˜¯å¦åœ¨å‰ååˆ†é’Ÿï¼ˆå‚è€ƒ P246 + P228 ifï¼‰ -->
<script>
  var now = new Date();
  var min = now.getMinutes();
  if (min >= 0 && min <= 9) {
    document.write("<div class='tip' style='background:#fff9e6;'>â° å½“å‰å¤„äºæ¯å°æ—¶å‰10åˆ†é’Ÿï¼Œä¸‹å•å¯äº«85æŠ˜ï¼</div>");
  } else {
    document.write("<div class='tip' style='background:#f5f5f5;'>ğŸ•’ å°æç¤ºï¼šæ¯å°æ—¶00~09åˆ†ä¸‹å•æœ‰85æŠ˜å“¦ï¼</div>");
  }
</script>

<!-- å®æ—¶é’Ÿè¡¨ -->
<div id="clockBox" style="font-weight:bold; color:#2c5aa0; margin:15px 0;"></div>

<!-- è®¢å•è¡¨å• -->
<div>
  <h3>æ·»åŠ æ–°è®¢å•</h3>
  <div class="form-group">
    <label>å®¢æˆ·åç§°ï¼š</label>
    <input type="text" id="customerName">
  </div>
  <div class="form-group">
    <label>å•†å“å•ä»·ï¼š</label>
    <input type="text" id="price">
  </div>
  <div class="form-group">
    <label>è´­ä¹°æ•°é‡ï¼š</label>
    <input type="text" id="quantity">
  </div>
  <div class="form-group">
    <label>å®¢æˆ·ç±»å‹ï¼š</label>
    <select id="isVip">
      <option value="false">æ™®é€šå®¢æˆ·</option>
      <option value="true">VIPå®¢æˆ·</option>
    </select>
  </div>
  <div class="form-group">
    <label>æ˜¯å¦åŠ æ€¥ï¼š</label>
    <input type="checkbox" id="isUrgent">
  </div>
  <button onclick="addOrder()">æ·»åŠ è®¢å•</button>
</div>

<!-- è®¢å•è®¡ç®—ç»“æœæ˜¾ç¤ºåŒº -->
<div id="resultArea"></div>

<!-- é”€å”®çœ‹æ¿ -->
<div>
  <h3>é”€å”®æˆäº¤å†å²</h3>
  <div id="dashboardTable"></div>
</div>

<script>
  // å…¨å±€è®¢å•æ•°ç»„ï¼ˆç”¨äºå­˜å‚¨å†å²è®°å½•ï¼‰
  var orderHistory = [];

  // æ›´æ–°æ—¶é’Ÿï¼ˆå‚è€ƒ P246 Date å¯¹è±¡æ–¹æ³•ï¼‰
  function updateClock() {
    var d = new Date();
    var year = d.getFullYear();
    var month = d.getMonth() + 1;
    var date = d.getDate();
    var hours = d.getHours();
    var minutes = d.getMinutes();
    var seconds = d.getSeconds();
    var week = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"][d.getDay()];
    
    var timeStr = year + "å¹´" + month + "æœˆ" + date + "æ—¥ æ˜ŸæœŸ" + week + " " +
                  (hours < 10 ? "0" + hours : hours) + ":" +
                  (minutes < 10 ? "0" + minutes : minutes) + ":" +
                  (seconds < 10 ? "0" + seconds : seconds);
    
    document.getElementById("clockBox").innerHTML = "å½“å‰æ—¶é—´ï¼š" + timeStr;
  }

  setInterval(updateClock, 1000);
  updateClock(); // ç«‹å³æ˜¾ç¤ºä¸€æ¬¡

  // ç¬¬ä¸‰æ–¹é¢ï¼šæ ¡éªŒè¾“å…¥ï¼ˆå‚è€ƒ P227 é€»è¾‘æˆ–ã€P233 å‡½æ•°å‚æ•°ã€alert å¼¹çª—ï¼‰
  function validateInput(name, price, qty) {
    // å®¢æˆ·åéç©ºï¼ˆé€»è¾‘æˆ–ï¼šname == null || name == ""ï¼‰
    if (name == null || name.trim() === "") {
      alert("å®¢æˆ·åç§°ä¸èƒ½ä¸ºç©ºï¼");
      return false;
    }
    // å•ä»· > 0 çš„æ•°å­—
    var p = parseFloat(price);
    if (isNaN(p) || p <= 0) {
      alert("å•†å“å•ä»·å¿…é¡»æ˜¯å¤§äº0çš„æ•°å­—ï¼");
      return false;
    }
    // æ•°é‡ > 0 çš„æ•´æ•°
    var q = parseInt(qty, 10);
    if (isNaN(q) || q <= 0 || q != qty) { // ç¡®ä¿æ˜¯æ•´æ•°
      alert("æ•°é‡å¿…é¡»æ˜¯å¤§äº0çš„æ•´æ•°ï¼");
      return false;
    }
    return true;
  }

  // ç¬¬å››æ–¹é¢ï¼šæ ¸å¿ƒè®¡ç®—é€»è¾‘ï¼ˆæŒ‰æ­¥éª¤èµ‹å€¼ï¼Œä½¿ç”¨ getElementById è¾“å‡ºï¼‰
  function addOrder() {
    var customerName = document.getElementById("customerName").value;
    var priceStr = document.getElementById("price").value;
    var qtyStr = document.getElementById("quantity").value;
    var isVip = document.getElementById("isVip").value === "true";
    var isUrgent = document.getElementById("isUrgent").checked;

    // æ ¡éªŒï¼ˆç¬¬ä¸‰æ–¹é¢ï¼‰
    if (!validateInput(customerName, priceStr, qtyStr)) {
      return;
    }

    var price = parseFloat(priceStr);
    var quantity = parseInt(qtyStr, 10);

    // â‘  åŸºç¡€æ€»ä»·
    var baseTotal = price * quantity;

    // â‘¡ VIP æŠ˜æ‰£
    var afterVip = isVip ? baseTotal * 0.9 : baseTotal;

    // â‘¢ åŠ æ€¥åŠ ä»·
    var afterUrgent = isUrgent ? afterVip * 1.1 : afterVip;

    // â‘£ è·å–å½“å‰åˆ†é’Ÿï¼Œåˆ¤æ–­æ˜¯å¦å‰ååˆ†é’Ÿ
    var now = new Date();
    var minute = now.getMinutes();
    var finalTotal = afterUrgent;
    var hasTimeDiscount = false;
    if (minute >= 0 && minute <= 9) {
      finalTotal = finalTotal * 0.85;
      hasTimeDiscount = true;
    }

    // æ–°å¢è§„åˆ™ï¼šæ™®é€šå®¢æˆ·ä¸”æ•°é‡ > 3 â†’ å†æ‰“9æŠ˜
    if (!isVip && quantity > 3) {
      finalTotal = finalTotal * 0.9;
    }

    // â‘¤ æ‹¼æ¥è¾“å‡ºå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨ <p> å’Œ <div> æ¢è¡Œï¼Œå‚è€ƒè¦æ±‚ï¼‰
    var tipsHtml = "";
    tipsHtml += "<p>å®¢æˆ·åç§°ï¼š" + customerName + "</p>";
    tipsHtml += "<p>åŸºç¡€æ€»ä»·ï¼ˆå•ä»·Ã—æ•°é‡ï¼‰ï¼š" + baseTotal.toFixed(2) + " å…ƒ</p>";
    tipsHtml += "<p>VIPå¤„ç†åï¼š" + afterVip.toFixed(2) + " å…ƒ</p>";
    tipsHtml += "<p>åŠ æ€¥å¤„ç†åï¼š" + afterUrgent.toFixed(2) + " å…ƒ</p>";
    if (hasTimeDiscount) {
      tipsHtml += "<p>å‰ååˆ†é’Ÿ85æŠ˜åï¼š" + (afterUrgent * 0.85).toFixed(2) + " å…ƒ</p>";
    }
    if (!isVip && quantity > 3) {
      tipsHtml += "<p>æ™®é€šå®¢æˆ·>3ä»¶ï¼Œé¢å¤–9æŠ˜ï¼Œæœ€ç»ˆï¼š" + finalTotal.toFixed(2) + " å…ƒ</p>";
    } else {
      tipsHtml += "<p>æœ€ç»ˆåº”ä»˜é‡‘é¢ï¼š" + finalTotal.toFixed(2) + " å…ƒ</p>";
    }

    document.getElementById("resultArea").innerHTML = "<div style='margin-top:15px; padding:10px; background:#f9f9f9;'>" + tipsHtml + "</div>";

    // å­˜å…¥å†å²ï¼ˆç¬¬äº”æ–¹é¢ï¼špush åˆ°æ•°ç»„ï¼‰
    orderHistory.push({
      name: customerName,
      price: price,
      qty: quantity,
      total: finalTotal,
      vip: isVip ? "æ˜¯" : "å¦",
      urgent: isUrgent ? "æ˜¯" : "å¦",
      timeDiscount: hasTimeDiscount ? "æ˜¯" : "å¦",
      bulkDiscount: (!isVip && quantity > 3) ? "æ˜¯" : "å¦"
    });

    // æ¸²æŸ“é”€å”®çœ‹æ¿ï¼ˆç¬¬äº”æ–¹é¢ï¼šç”¨ <table><td> æ˜¾ç¤ºï¼‰
    renderDashboard();
  }

  // ç¬¬äº”æ–¹é¢ï¼šæ¸²æŸ“æˆäº¤å†å²è¡¨æ ¼
  function renderDashboard() {
    if (orderHistory.length === 0) {
      document.getElementById("dashboardTable").innerHTML = "<p>æš‚æ— æˆäº¤è®°å½•</p>";
      return;
    }

    var tableHtml = "<table>";
    tableHtml += "<tr><th>å®¢æˆ·</th><th>å•ä»·</th><th>æ•°é‡</th><th>æœ€ç»ˆé‡‘é¢</th><th>VIP</th><th>åŠ æ€¥</th><th>æ—¶æ®µæŠ˜æ‰£</th><th>æ‰¹é‡æŠ˜æ‰£</th></tr>";
    
    for (var i = 0; i < orderHistory.length; i++) {
      var o = orderHistory[i];
      tableHtml += "<tr>";
      tableHtml += "<td>" + o.name + "</td>";
      tableHtml += "<td>" + o.price.toFixed(2) + "</td>";
      tableHtml += "<td>" + o.qty + "</td>";
      tableHtml += "<td>" + o.total.toFixed(2) + "</td>";
      tableHtml += "<td>" + o.vip + "</td>";
      tableHtml += "<td>" + o.urgent + "</td>";
      tableHtml += "<td>" + o.timeDiscount + "</td>";
      tableHtml += "<td>" + o.bulkDiscount + "</td>";
      tableHtml += "</tr>";
    }
    tableHtml += "</table>";

    document.getElementById("dashboardTable").innerHTML = tableHtml;
  }
</script>

</body>
</html>